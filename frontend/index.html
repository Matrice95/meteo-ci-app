<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√©t√©o CI - T√©l√©chargement de Donn√©es</title>
    
    <!-- Leaflet CSS pour la carte -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Flatpickr pour les date pickers -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Notre CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-cloud-sun-rain"></i>
                    <h1>M√©t√©o CI Hub</h1>
                </div>
                <div class="header-info">
                    <div class="status-badge" id="connectionStatus">
                        <i class="fas fa-circle"></i>
                        <span>Connexion...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            
            <!-- Instructions -->
            <section class="intro-section">
                <h2>Donn√©es temps r√©el du r√©seau de stations SODEXAM</h2>
                <p>S√©lectionnez le type de station, puis les stations, la p√©riode et les param√®tres pour t√©l√©charger vos donn√©es au format CSV.</p>
            </section>

            <!-- √âtape 0 : S√©lection du type de station -->
            <section class="section" id="stationTypeSection">
                <div class="section-header">
                    <div class="step-badge">0</div>
                    <h3>Type de station</h3>
                </div>
                
                <div class="form-group">
                    <label for="stationType">
                        <i class="fas fa-network-wired"></i>
                        S√©lectionnez le type de r√©seau de stations
                    </label>
                    <select id="stationType" class="form-select">
                        <option value="pulsonic" selected>Pulsonic - R√©seau principal SODEXAM</option>
                        <option value="campbell" disabled>Campbell - Stations sp√©cialis√©es (bient√¥t disponible)</option>
                    </select>
                    <small class="form-hint">
                        Le type de station d√©termine les stations disponibles et leurs param√®tres mesur√©s
                    </small>
                </div>
            </section>

            <!-- √âtape 1 : S√©lection des stations -->
            <section class="section" id="stationsSection">
                <div class="section-header">
                    <div class="step-badge">1</div>
                    <h3>S√©lection des stations</h3>
                </div>
                
                <div class="stations-container">
                    <!-- Carte interactive -->
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="map-legend">
                            <div class="legend-item">
                                <span class="legend-marker urbaine"></span>
                                <span>Station urbaine</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-marker rurale"></span>
                                <span>Station rurale</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Liste des stations -->
                    <div class="stations-list">
                        <div class="list-header">
                            <input type="text" id="searchStation" placeholder="üîç Rechercher une station..." class="search-input">
                            <div class="filter-buttons">
                                <button class="btn-filter active" data-filter="all">Toutes</button>
                                <button class="btn-filter" data-filter="urbaine">Urbaines</button>
                                <button class="btn-filter" data-filter="rurale">Rurales</button>
                            </div>
                        </div>
                        
                        <div class="select-actions">
                            <button id="selectAllStations" class="btn-link">Tout s√©lectionner</button>
                            <button id="deselectAllStations" class="btn-link">Tout d√©s√©lectionner</button>
                            <span class="selected-count">0 station(s) s√©lectionn√©e(s)</span>
                        </div>
                        
                        <div id="stationsList" class="stations-grid">
                            <!-- Les stations seront charg√©es ici par JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- √âtape 2 : Disponibilit√© des donn√©es -->
            <section class="section" id="availabilitySection" style="display: none;">
                <div class="section-header">
                    <div class="step-badge">2</div>
                    <h3>Disponibilit√© des donn√©es</h3>
                </div>
                
                <div class="availability-container">
                    <div class="granularity-selector">
                        <label for="granularity">Granularit√© des donn√©es :</label>
                        <select id="granularity" class="form-select">
                            <option value="H" selected>Horaire</option>
                            <option value="J">Journali√®re</option>
                            <option value="X">6 minutes</option>
                            <option value="U">Minute</option>
                        </select>
                        <button id="checkAvailability" class="btn btn-secondary">
                            <i class="fas fa-sync"></i> V√©rifier la disponibilit√©
                        </button>
                    </div>
                    
                    <div id="availabilityResults" class="availability-results">
                        <!-- Les r√©sultats seront affich√©s ici -->
                    </div>
                </div>
            </section>

            <!-- √âtape 3 : S√©lection de la p√©riode -->
            <section class="section" id="periodSection" style="display: none;">
                <div class="section-header">
                    <div class="step-badge">3</div>
                    <h3>P√©riode de t√©l√©chargement</h3>
                </div>
                
                <div class="period-container">
                    <div class="date-inputs">
                        <div class="form-group">
                            <label for="startDate">
                                <i class="fas fa-calendar-alt"></i> Date de d√©but
                            </label>
                            <input type="text" id="startDate" class="form-input" placeholder="YYYY-MM-DD" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="endDate">
                                <i class="fas fa-calendar-alt"></i> Date de fin
                            </label>
                            <input type="text" id="endDate" class="form-input" placeholder="YYYY-MM-DD" readonly>
                        </div>
                    </div>
                    
                    <div class="quick-dates">
                        <span>Raccourcis :</span>
                        <button class="btn-quick-date" data-period="7">7 derniers jours</button>
                        <button class="btn-quick-date" data-period="30">30 derniers jours</button>
                        <button class="btn-quick-date" data-period="90">3 derniers mois</button>
                        <button class="btn-quick-date" data-period="365">Derni√®re ann√©e</button>
                    </div>
                    
                    <div id="estimateInfo" class="estimate-info" style="display: none;">
                        <!-- Estimation du volume -->
                    </div>
                </div>
            </section>

            <!-- √âtape 4 : S√©lection des param√®tres -->
            <section class="section" id="parametersSection" style="display: none;">
                <div class="section-header">
                    <div class="step-badge">4</div>
                    <h3>S√©lection des param√®tres</h3>
                </div>
                
                <div class="parameters-container">
                    <div class="parameters-header">
                        <input type="text" id="searchParameter" placeholder="üîç Rechercher un param√®tre..." class="search-input">
                        <div class="select-actions">
                            <button id="selectAllParams" class="btn-link">Tout s√©lectionner</button>
                            <button id="deselectAllParams" class="btn-link">Tout d√©s√©lectionner</button>
                            <span class="selected-params-count">0 param√®tre(s) s√©lectionn√©(s)</span>
                        </div>
                    </div>
                    
                    <div id="parametersList" class="parameters-grid">
                        <!-- Les param√®tres seront charg√©s ici par JS -->
                    </div>
                </div>
            </section>

            <!-- √âtape 5 : T√©l√©chargement -->
            <section class="section" id="downloadSection" style="display: none;">
                <div class="section-header">
                    <div class="step-badge">5</div>
                    <h3>T√©l√©chargement</h3>
                </div>
                
                <div class="download-container">
                    <div class="download-summary">
                        <h4>R√©capitulatif de votre demande</h4>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <div>
                                    <strong>Stations</strong>
                                    <span id="summaryStations">-</span>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-calendar-range"></i>
                                <div>
                                    <strong>P√©riode</strong>
                                    <span id="summaryPeriod">-</span>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-sliders-h"></i>
                                <div>
                                    <strong>Param√®tres</strong>
                                    <span id="summaryParams">-</span>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-database"></i>
                                <div>
                                    <strong>Volume estim√©</strong>
                                    <span id="summaryVolume">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="download-actions">
                        <button id="downloadBtn" class="btn btn-primary btn-large">
                            <i class="fas fa-download"></i>
                            T√©l√©charger le fichier CSV
                        </button>
                    </div>
                    
                    <div id="downloadProgress" class="download-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p class="progress-text" id="progressText">Pr√©paration du t√©l√©chargement...</p>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 M√©t√©o CI - Plateforme de t√©l√©chargement de donn√©es m√©t√©orologiques</p>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>
    
    <script src="js/api.js"></script>
    <script src="js/map.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
